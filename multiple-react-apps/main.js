(()=>{"use strict";var t={247:function(t,e){var s=this&&this.__awaiter||function(t,e,s,o){return new(s||(s=Promise))((function(n,r){function i(t){try{u(o.next(t))}catch(t){r(t)}}function a(t){try{u(o.throw(t))}catch(t){r(t)}}function u(t){var e;t.done?n(t.value):(e=t.value,e instanceof s?e:new s((function(t){t(e)}))).then(i,a)}u((o=o.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0}),e.RouterBase=void 0,e.RouterBase=class{constructor(t){this.routes=[],this.routes=[],this.options=Object.assign({debug:!1},t),this.always((()=>null)),this._listener=()=>this._onLocationChange(!1),this._subscribe(),this.resolve(),window.addEventListener("DOMContentLoaded",this._listener)}dispose(){this._prevState=null,this._prevUrl=null,this._unsubscribe()}applyState(){return this._saveState(document.location.pathname,history.state),this._onLocationChange(!0)}pushState(t="/",e={}){return s(this,void 0,void 0,(function*(){return e.reverted||this._saveState(document.location.pathname,history.state),t!==location.pathname?history.pushState(e,document.title,t):history.replaceState(e,document.title,t),this._resolving?Promise.resolve(!1):yield this._onLocationChange()}))}popState(){history.back()}replaceState(t="/",e={}){return s(this,void 0,void 0,(function*(){return history.replaceState(e,document.title,t),yield this._onLocationChange()}))}resolve(t=(()=>Promise.resolve(!0))){return this._resolver=t,this}on(t,e){return this.routes.push({route:t,handler:e}),this}default(t){return this.routes.push({route:"",handler:t}),this}always(t){return this.alwaysFunc=t,this}_getRouteParser(t){const e=[];let s;if(t instanceof RegExp)s=t;else{const o=t.replace(/([:*])(\w+)/g,((t,s,o)=>(e.push(o),"([^/]+)"))).replace(/\*/g,"(?:.*)");s=new RegExp(`/${o}(?:/$|$)/`)}return{paramNames:e,regexp:s}}_collectRouteParams(t,e){return t.slice(1,t.length).reduce(((t,s,o)=>(t[e[o]]=decodeURIComponent(s),t)),{})}_onLocationChange(t){return s(this,void 0,void 0,(function*(){const e=decodeURI(location.pathname);var s;this.options.debug&&(s=`pushChange, ${e}`,console.log(`%c[Router]%c ${s}`,"color: rgb(255, 105, 100);","color: inherit")),yield this._resolveLocation(e,history.state,t)}))}_revertState(){return this._prevUrl?this.pushState(this._prevUrl,Object.assign(Object.assign({},this._prevState),{reverted:!0})):(this.popState(),Promise.resolve(!0))}_resolveLocation(t,e,o){return s(this,void 0,void 0,(function*(){return this._handleRoutes(t,e,o),this._saveState(t,e),yield this.alwaysFunc(t,e),Promise.resolve(!0)}))}_handleRoutes(t,e,s){for(let o=0;o<this.routes.length;o++){const n=this._getRouteParser(this.routes[o].route),r=t.match(n.regexp);if(r){const i=this._collectRouteParams(r,n.paramNames);this.routes[o].handler.call(null,{path:t,state:e,params:i,applied:s});break}}}_subscribe(){this._subscribed||(window.addEventListener("popstate",this._listener),this._subscribed=!0)}_unsubscribe(){this._subscribed&&(window.removeEventListener("popstate",this._listener),this._subscribed=!1)}_saveState(t,e){this._prevUrl=t,this._prevState=e}}},853:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.glazeReact=void 0;const s=(t,e,s,o)=>(n,r)=>{const i=document.createElement("div");i.setAttribute("glaze","react-app-wrapper"),n.appendChild(i),o&&o(r,i);const a=e.createElement(t,r);return s.render(a,i),i},o=t=>(e,s)=>{t.unmountComponentAtNode(s),e.removeChild(s)};e.glazeReact=function(t,e,n,r){return{mount:s(t,e,n,r),unmount:o(n)}}},858:function(t,e){var s=this&&this.__awaiter||function(t,e,s,o){return new(s||(s=Promise))((function(n,r){function i(t){try{u(o.next(t))}catch(t){r(t)}}function a(t){try{u(o.throw(t))}catch(t){r(t)}}function u(t){var e;t.done?n(t.value):(e=t.value,e instanceof s?e:new s((function(t){t(e)}))).then(i,a)}u((o=o.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0}),e.bootstrap=e.app=e.createApps=e.App=e.blankApp=void 0;const o=new class{constructor(){this.readyToDispatch=null,this.readyToDispatchResolver=null,this.observers=[],this.readyToDispatch=new Promise((t=>{this.readyToDispatchResolver=t})),this.log=(t,...e)=>{this.options.debug&&console.log("[glaze]",t,...e)}}setOptions(t){this.options=Object.assign({debug:!1},t)}start(t,e,o,n){return s(this,void 0,void 0,(function*(){if(!o)return e(this);this.router=o,yield o.start(t,n),e(this),this.readyToDispatchResolver()}))}getLazyDispatch(t=Promise.resolve()){return e=>{t.then((()=>{this.observers.forEach((t=>{t(e)}))}))}}dispatch(t){this.log("[glaze send]",t),this.readyToDispatch.then((()=>{this.observers.forEach((e=>{e(t)}))}))}subscribe(t){return this.observers.push(t),{unsubscribe:()=>{this.removeItem(this.observers,t)}}}removeItem(t,e){const s=t.indexOf(e);return s>-1&&t.splice(s,1),t}};class n{constructor(...t){t.forEach((t=>{if(this[t.name])throw new Error(`App ${t.name} already exists`);this[t.name]=t}))}}e.blankApp={mount:()=>{},unmount:()=>{}};class r{constructor(t,e){this.name=t,this.bootstrap=e}mount(t,e,n){return s(this,void 0,void 0,(function*(){yield this.checkInstance();var s=o.getLazyDispatch(n);return this.instance.mount(t,Object.assign(Object.assign({},e),{name:this.name,glaze:o,dispatch:s}))}))}unmount(t,e){return s(this,void 0,void 0,(function*(){return this.instance.unmount(t,e)}))}checkInstance(){return s(this,void 0,void 0,(function*(){if(this.instance)return this.instance;"string"==typeof this.bootstrap?this.bootstrap=yield System.import(`@glaze/${this.name}`):"function"==typeof this.bootstrap?this.bootstrap=this.bootstrap():this.bootstrap=this.bootstrap,this.bootstrap instanceof Promise&&(this.bootstrap=yield this.bootstrap),this.instance=this.bootstrap}))}}e.App=r,e.createApps=function(t){return new n(...t)},e.app=function(t,e){return new r(t,e)},e.bootstrap=function(t){const{container:e,apps:n,router:r,sharedLibs:i,options:a}=t;if(!e)throw new Error("Container is required");return o.setOptions(a),new Promise(((t,u)=>{var c=document.getElementsByTagName("head")[0],l=document.getElementsByTagName("body")[0],h=(t,e,s,o)=>t.appendChild(Object.keys(s).reduce(((t,e)=>t.setAttribute(e,s[e])||t),document.createElement(e))).append(o||"");h(c,"meta",{name:"importmap-type",content:"systemjs-importmap"}),h(c,"script",{type:"systemjs-importmap"},JSON.stringify({imports:Object.assign(Object.assign({},i),Object.keys(n).filter((t=>"string"==typeof n[t].bootstrap)).reduce(((t,e)=>Object.assign(Object.assign({},t),{[`@glaze/${n[e].name}`]:n[e].bootstrap||"#"})),{}))})),h(c,"script",{src:"https://cdn.jsdelivr.net/npm/systemjs@6.8.3/dist/system.min.js"}),h(c,"script",{src:"https://cdn.jsdelivr.net/npm/import-map-overrides@2.2.0/dist/import-map-overrides.js"}),h(l,"import-map-overrides-full",{"show-when-local-storage":"devtools","dev-libs":""});const p=()=>s(this,void 0,void 0,(function*(){window.removeEventListener("load",p);try{yield o.start(e,t,r,a),o.log("Framework started")}catch(t){u(t)}}));window.addEventListener("load",p)}))}},913:(t,e,s)=>{e.az=e.FL=e.BC=e.te=e.sg=e.vB=e.l2=e.Ux=e.QL=void 0;var o=s(858);Object.defineProperty(e,"QL",{enumerable:!0,get:function(){return o.createApps}}),Object.defineProperty(e,"Ux",{enumerable:!0,get:function(){return o.bootstrap}}),Object.defineProperty(e,"l2",{enumerable:!0,get:function(){return o.app}}),Object.defineProperty(e,"vB",{enumerable:!0,get:function(){return o.blankApp}});var n=s(928);Object.defineProperty(e,"sg",{enumerable:!0,get:function(){return n.createRoutes}}),Object.defineProperty(e,"te",{enumerable:!0,get:function(){return n.createLayout}}),Object.defineProperty(e,"BC",{enumerable:!0,get:function(){return n.route}}),Object.defineProperty(e,"FL",{enumerable:!0,get:function(){return n.defaultRoute}});s(853);var r=s(744);Object.defineProperty(e,"az",{enumerable:!0,get:function(){return r.createElement}})},744:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.createElement=void 0,e.createElement=(t,e,...o)=>{if("function"==typeof t)return t(e,...o);const n=document.createElement(t);return Object.entries(e||{}).forEach((([t,e])=>{t.startsWith("on")&&t.toLowerCase()in window?n.addEventListener(t.toLowerCase().substr(2),e):("className"===t&&(t="class"),n.setAttribute(t,e.toString()))})),o.forEach((t=>{s(n,t)})),n};const s=(t,e)=>{Array.isArray(e)?e.forEach((e=>s(t,e))):t.appendChild(e.nodeType?e:document.createTextNode(e))}},356:function(t,e){var s=this&&this.__awaiter||function(t,e,s,o){return new(s||(s=Promise))((function(n,r){function i(t){try{u(o.next(t))}catch(t){r(t)}}function a(t){try{u(o.throw(t))}catch(t){r(t)}}function u(t){var e;t.done?n(t.value):(e=t.value,e instanceof s?e:new s((function(t){t(e)}))).then(i,a)}u((o=o.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0}),e.Pipeline=void 0,e.Pipeline=function(...t){const e=t;return{push:(...t)=>{e.push(...t)},execute:t=>s(this,void 0,void 0,(function*(){let o=-1;const n=r=>s(this,void 0,void 0,(function*(){if(r===o)throw new Error("next() called multiple times");o=r;const s=e[r];s&&(yield s.executor(t,(()=>n(r+1))))}));yield n(0)}))}}},928:function(t,e,s){var o=this&&this.__awaiter||function(t,e,s,o){return new(s||(s=Promise))((function(n,r){function i(t){try{u(o.next(t))}catch(t){r(t)}}function a(t){try{u(o.throw(t))}catch(t){r(t)}}function u(t){var e;t.done?n(t.value):(e=t.value,e instanceof s?e:new s((function(t){t(e)}))).then(i,a)}u((o=o.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0}),e.defaultRoute=e.route=e.createLayout=e.createRoutes=e.Layout=e.Router=e.Route=void 0;const n=s(247),r=s(356),i=s(858);e.Route=class{constructor(t,s,o){if(this.path=t,this.requestHander=o,"function"==typeof s)return this.requestHander=s,void(this.layout=null);if(s instanceof i.App){const t=document.createElement("div");t.setAttribute("id",s.name),t.setAttribute("glaze","layout-auto-generated"),this.layout=(0,e.createLayout)(t,{[s.name]:s})}else this.layout=s}};class a{constructor(t){this.routeChangeStack=[],this.cancelPrevRouteChange=!1,this.router=new n.RouterBase,this.pipeline=(0,r.Pipeline)(...t)}addBaseUrl(t){var e;return t.startsWith(null!==(e=this.baseUrl)&&void 0!==e?e:"/")?t:this.baseUrl+t}navigate(t,e){return o(this,void 0,void 0,(function*(){return t=this.addBaseUrl(t),yield this.router.pushState(t,e)}))}start(t,e){return o(this,void 0,void 0,(function*(){return new Promise((s=>o(this,void 0,void 0,(function*(){this.baseUrl=(null==e?void 0:e.baseUrl)||"",this.baseUrl.endsWith("/")?this.baseUrl.substring(this.baseUrl.length-1):this.baseUrl,this.router.always(((e,n)=>o(this,void 0,void 0,(function*(){yield this.onRouteChange(t)(e,n),s()})))),yield this.navigate(location.pathname,location.search)}))))}))}forward(){window.history.forward()}back(){this.router.popState()}injectRouterInLinks(){[...document.getElementsByTagName("a")].forEach((t=>{t.onclick&&"noop"!==t.onclick.name||(t.onclick=t=>o(this,void 0,void 0,(function*(){var e=t.currentTarget.pathname;t.preventDefault(),yield this.navigate(e)})))}))}onRouteChange(t){return new u(this.routeChangeStack,((e,s)=>(n,r)=>o(this,void 0,void 0,(function*(){n=n.replace(this.baseUrl,"");const o=new URLSearchParams(r),i=r?Object.fromEntries(o.entries()):{};var a={path:n,state:i,matches:[]};if(yield this.pipeline.execute(a),s())return;a.matches.sort(((t,e)=>t.score>e.score?-1:e.score>t.score?1:0));const u=a.matches[0],{layout:c}=u;this.prevLayout&&(yield this.prevLayout.unmount(t),this.prevLayout=null),c&&(e(),yield c.mount(t),this.prevLayout=c,this.routeChangeStack=[],this.injectRouterInLinks())})))).run}}e.Router=a;class u{constructor(t,e){this.routeChangeStack=t,this.func=e,this.cancelRoute=!1,this.run=this.func((()=>{for(;this.routeChangeStack.length>1;)this.routeChangeStack.shift().cancel()}),(()=>this.cancelRoute)),t.push(this)}cancel(){this.cancelRoute=!0}}class c{constructor(t,e){this.template=t,this.apps=e}mount(t){return o(this,void 0,void 0,(function*(){t.appendChild(this.template);var e,s=[];const o=new Promise((t=>{e=t}));for(let e in this.apps){const n=this.apps[e];if(!n)throw new Error(`App ${e} not found`);const r=t.querySelector(`#${e}`);if(!r)throw new Error(`Div ${e} not found in layout template`);s.push(n.mount(r,this.template,o))}var n=yield Promise.all(s);const r=this.apps?Object.keys(this.apps):[];n.map(((t,e)=>this.apps[r[e]].renderedApp=t)),setTimeout((()=>e()),10)}))}unmount(t){return o(this,void 0,void 0,(function*(){var e=[];for(let s in this.apps){const o=this.apps[s],n=t.querySelector(`#${s}`);e.push(o.unmount(n,o.renderedApp))}yield Promise.all(e),this.apps&&Object.keys(this.apps).forEach((t=>delete this.apps[t].renderedApp)),t.removeChild(this.template)}))}}e.Layout=c,e.createRoutes=t=>{var e=t.map((t=>"function"==typeof t?{name:"custom",executor:t}:t));if(e.filter((t=>"defaultRoute"===t.type)).length>1)throw new Error("Only one default route is allowed");const s=e.findIndex((t=>"defaultRoute"===t.type));if(-1!==s){const t=e.splice(s,1)[0];e.push(t)}return new a(e)},e.createLayout=(t,e)=>new c(t,e);const l=t=>{var s;if(t instanceof i.App){const o=document.createElement("div");o.setAttribute("id",t.name),o.setAttribute("glaze","layout-auto-generated"),s=(0,e.createLayout)(o,{[t.name]:t})}else s=t;return s};e.route=(t,e)=>({type:"route",executor:(s,o)=>{const n=l(e);"/"===t&&"/"===s.path?s.matches.push({score:100,layout:n}):t.substring(1)&&s.path.toLocaleLowerCase().substring(1).startsWith(t.toLocaleLowerCase().substring(1))&&s.matches.push({score:t.length,layout:n}),o()}}),e.defaultRoute=t=>({type:"defaultRoute",executor:(e,s)=>{if(e.matches.length>0)return s();const o=l(t);e.matches.push({score:100,layout:o}),s()}})}},e={};function s(o){var n=e[o];if(void 0!==n)return n.exports;var r=e[o]={exports:{}};return t[o].call(r.exports,r,r.exports,s),r.exports}(()=>{var t=s(913);const e=(0,t.QL)([(0,t.l2)("navbar","https://yoda-libs.github.io/glaze-ui-examples/multiple-react-apps/navbar.js"),(0,t.l2)("todo","https://yoda-libs.github.io/glaze-ui-examples/multiple-react-apps/todo.js"),(0,t.l2)("footer","https://yoda-libs.github.io/glaze-ui-examples/multiple-react-apps/footer.js"),(0,t.l2)("login","https://yoda-libs.github.io/glaze-ui-examples/multiple-react-apps/login.js")]),o=(s,o)=>(0,t.te)((0,t.az)("div",{className:"layout"},(0,t.az)("div",{id:"navbar"}),(0,t.az)("div",{className:"content-outer"},(0,t.az)("div",{id:"content"},s)),(0,t.az)("div",{id:"footer"})),{navbar:e.navbar,content:o,footer:e.footer}),n=(0,t.te)((0,t.az)("div",{className:"outer"},(0,t.az)("div",{className:"outer"},(0,t.az)("div",{className:"inner"},(0,t.az)("div",{id:"login"})))),{login:e.login}),r=(0,t.az)("div",{className:"outer"},(0,t.az)("div",{className:"outer"},(0,t.az)("div",{className:"inner"},(0,t.az)("h1",null,"404 Page Not Found")))),i=(0,t.sg)([async(t,e)=>{if(t.path.startsWith("/login"))return e();if(t.path.startsWith("/logout"))return localStorage.removeItem("token"),await i.navigate("/login");if(t.path.startsWith("/auth")){const{token:e}=t.state;return localStorage.setItem("token",e),await i.navigate("/")}if(!localStorage.getItem("token"))return await i.navigate("/login");e()},(0,t.BC)("/",o("",e.todo)),(0,t.BC)("/login",n),(0,t.FL)(o(r,t.vB))],{baseUrl:"/glaze-ui-examples/multiple-react-apps"});(0,t.Ux)({container:document.getElementById("root"),apps:e,router:i,sharedLibs:{react:"https://unpkg.com/react@17.0.2/umd/react.development.js","react-dom":"https://unpkg.com/react-dom@17.0.2/umd/react-dom.development.js"},options:{debug:!0}}).then((async t=>{t.dispatch({test:"message"})})).catch(console.error)})()})();
//# sourceMappingURL=main.js.map